
% Performs a gradient descent linear approximation of the data [x,y] 
% with step size equal to 'learning_rate' and stoping when the given
% 'treshold' value is met between the difference of errors in each
% successive iteration. 
% 'doplot' is a boolean value indicating if a continuous approximation plot
% should be performed to visually observe the process
function [w, conv_matrix] = gdescent(x,y,learning_rate,threshold,num_iterations, doplot, modified)
    min_error = realmax;
    original_x = x;
    o = ones(size(x,1),1);
    x = [o,x];
    x = x';   
    w = [1;1];
    n = 1/size(x,2)
    n2 = n/2
    count = 0;
    %previous_error = realmax;
    error = realmax;
    min_error = realmax;
   
    conv_matrix = [];
    h = plot([0],[0]);
        
    % for plotting
    %h = plot(x,y,'g-');
    % count==0 just simulates a do-while
    while num_iterations >0
        num_iterations = num_iterations-1;
    %while((previous_error-min_error) > threshold || count==0)
        % calculate gradient
        divided_x = n.*x;
        gradient_delta = divided_x*((x'*w)-y);
        
        % update weights
        if modified
            grad = gradient_delta./norm(gradient_delta);
            w = w - learning_rate.*grad;
        else
            w = w - learning_rate.*gradient_delta;
        end
        
        % calculate new minimum
        %previous_error = min_error;
        error = (n2.*((x'*w)-y)')*((x'*w)-y);
        if error<min
        
        count = count+1;
        
        % adds value to convergence matrix
        conv_matrix = [conv_matrix; count min_error];
        
        % plot just when random happens to make it possible
        % to be visualized
        if doplot & rand(1,1)<0.05
            pause(0.01)
            delete(h);
            new_y = lfunc(w(2),w(1),original_x);
            h = plot(original_x,new_y,'g-'); 
        end
    end
    
    if doplot
        delete(h);
    end
    disp(strcat('Num Iterations: ',num2str(count)));
    disp(strcat('Min Error: ',num2str(min_error)));
end